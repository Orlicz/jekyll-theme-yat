<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<p>zkw 线段树并没有实际的意义，这远远不如seg beats困难和有区分度。但是无所谓</p>

<p>以下是我的zkw</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span><span class="n">T</span> <span class="n">e</span><span class="p">,</span><span class="k">class</span> <span class="nc">F</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="o">&amp;&amp;</span><span class="p">)(</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="p">)&gt;</span>
<span class="k">struct</span> <span class="nc">zkw</span><span class="p">{</span>
	<span class="n">F</span> <span class="n">f</span><span class="p">;</span><span class="n">T</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="o">&lt;&lt;</span><span class="n">__lg</span><span class="p">(</span><span class="n">maxn</span><span class="p">)];</span><span class="kt">int</span> <span class="n">m</span><span class="p">;</span>
	<span class="n">zkw</span><span class="p">(</span><span class="n">F</span> <span class="k">const</span><span class="o">&amp;</span><span class="n">f</span><span class="o">=</span><span class="n">F</span><span class="p">())</span><span class="o">:</span><span class="n">f</span><span class="p">(</span><span class="n">f</span><span class="p">){}</span>
	<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span><span class="n">m</span><span class="o">=</span><span class="mi">2</span><span class="o">&lt;&lt;</span><span class="n">__lg</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="n">fill</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="p">(</span><span class="n">m</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">),</span><span class="n">e</span><span class="p">);}</span>
	<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">A</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
		<span class="n">m</span><span class="o">=</span><span class="mi">2</span><span class="o">&lt;&lt;</span><span class="n">__lg</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">));</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="p">(</span><span class="n">m</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">),</span><span class="n">e</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">m</span><span class="p">;</span><span class="o">--</span><span class="n">i</span><span class="p">;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">]));</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">upd</span><span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">,</span><span class="n">T</span> <span class="n">x</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="o">|=</span><span class="n">m</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">p</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">]));}</span>
	<span class="n">T</span> <span class="nf">qry</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
		<span class="n">T</span> <span class="n">res</span><span class="o">=</span><span class="n">e</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">l</span><span class="o">+=</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">+=</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">l</span><span class="o">^</span><span class="n">r</span><span class="o">^</span><span class="mi">1</span><span class="p">;</span><span class="n">l</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">){</span>
			<span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="n">l</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="o">^</span><span class="mi">1</span><span class="p">],</span><span class="n">res</span><span class="p">);</span>
			<span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="o">^</span><span class="mi">1</span><span class="p">]);</span>
		<span class="p">}</span><span class="k">return</span> <span class="n">res</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
<!--stackedit_data:
eyJoaXN0b3J5IjpbNzQxMDM1OTA4XX0=
-->
</body></html>
