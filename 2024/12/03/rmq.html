<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h3 id="rmq">RMQ</h3>

<p>线性RMQ的速度是很差的，原因是，内存是新的硬盘。</p>

<p>我可以在1s内执行1e9次cpu密集的任务，但rmq的瓶颈在于访问内存</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define lg(x) (31^__builtin_clz(x))
#define ctz __builtin_ctz
</span><span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">st</span><span class="p">[</span><span class="n">__lg</span><span class="p">(</span><span class="n">maxn</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">][</span><span class="n">maxn</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">];</span>
<span class="kt">unsigned</span> <span class="n">msk</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
	<span class="kt">unsigned</span> <span class="n">cur</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bas</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">31</span><span class="p">))</span><span class="n">cur</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bas</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
		<span class="k">while</span><span class="p">(</span><span class="n">cur</span><span class="o">&amp;&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">a</span><span class="p">[</span><span class="n">bas</span><span class="o">|</span><span class="n">lg</span><span class="p">(</span><span class="n">cur</span><span class="p">)])</span><span class="n">cur</span><span class="o">^=</span><span class="mi">1u</span><span class="o">&lt;&lt;</span><span class="n">lg</span><span class="p">(</span><span class="n">cur</span><span class="p">);</span>
		<span class="n">msk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">cur</span><span class="o">|=</span><span class="mi">1u</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">bas</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">bas</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">bas</span><span class="o">+=</span><span class="mi">32</span><span class="p">)</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">bas</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">bas</span><span class="o">|</span><span class="n">ctz</span><span class="p">(</span><span class="n">msk</span><span class="p">[</span><span class="n">bas</span><span class="o">|</span><span class="mi">31</span><span class="p">])];</span>
	<span class="o">--</span><span class="n">n</span><span class="p">;</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[(</span><span class="n">n</span><span class="o">&amp;~</span><span class="mi">31</span><span class="p">)</span><span class="o">|</span><span class="n">ctz</span><span class="p">(</span><span class="n">msk</span><span class="p">[</span><span class="n">n</span><span class="p">])];</span><span class="n">n</span><span class="o">&gt;&gt;=</span><span class="mi">5</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">j</span><span class="p">)</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))]);</span>
<span class="p">}</span>
<span class="k">auto</span> <span class="nf">qmin</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">ql</span><span class="o">=</span><span class="n">l</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">,</span><span class="n">qr</span><span class="o">=</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ql</span><span class="o">==</span><span class="n">qr</span><span class="p">)</span><span class="k">return</span> <span class="n">a</span><span class="p">[(</span><span class="n">l</span><span class="o">&amp;~</span><span class="mi">31</span><span class="p">)</span><span class="o">|</span><span class="n">ctz</span><span class="p">(</span><span class="n">msk</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">l</span><span class="o">&amp;</span><span class="mi">31</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">l</span><span class="o">&amp;</span><span class="mi">31</span><span class="p">))];</span>
	<span class="cp">#define _0 a[(l&amp;~31)|ctz(msk[l|31]&gt;&gt;(l&amp;31)&lt;&lt;(l&amp;31))]
</span>	<span class="cp">#define _1 a[(r&amp;~31)|ctz(msk[r])]
</span>	<span class="k">if</span><span class="p">(</span><span class="n">ql</span><span class="o">+</span><span class="mi">1</span><span class="o">==</span><span class="n">qr</span><span class="p">)</span><span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">_0</span><span class="p">,</span><span class="n">_1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">g</span><span class="o">=</span><span class="n">lg</span><span class="p">(</span><span class="n">qr</span><span class="o">-</span><span class="n">ql</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
	<span class="k">auto</span> <span class="n">va</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">ql</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">st</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">qr</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">g</span><span class="p">)]);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">va</span><span class="o">==</span><span class="n">min</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">ql</span><span class="p">],</span><span class="n">st</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">qr</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">g</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="k">return</span> <span class="n">va</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">min</span><span class="p">(</span><span class="n">_0</span><span class="p">,</span><span class="n">_1</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>随机情况下，唐诗的事情是，1024分段然后求解这个的复杂度最好。（1024=sqrt）。</p>

<p>但是为什么要放任一个空间常数巨大的做法呢？</p>

<p>上述的rmq瓶颈在于内存访问。人们难以加快它。如果真的需要加快，可以采用将a和msk等信息并列的方法。（但是不会有多少收益）</p>

<p>这个rmq速度是上乘的，一个优化还是我在github上学习的。</p>

<p>随机rmq没有意义。</p>

<hr>

<p>之前cf有一个好题，内容是，就是昨天的div2</p>

<p>最后一个题目我一下子就做出来了。主要就是线性的。可能的瓶颈是LCA。</p>

<p>转化成有根树，然后考虑对于指定的连通块求解信息。</p>

<p>还好吧。注意今天的cf!
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTQwOTQ5NTk4Ml19
--></p>
</body></html>
